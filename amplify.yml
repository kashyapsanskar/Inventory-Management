version: 1

applications:
  - appRoot: .  # Frontend root directory
    frontend:
      phases:
        preBuild:
          commands:
            - echo "Installing frontend dependencies..."
            - npm ci
        build:
          commands:
            - echo "Building frontend..."
            - npm run build  # Ensure this is the correct build command for Next.js
        postBuild:
          commands:
            - echo "Frontend deployed successfully"
      artifacts:
        files:
          - '**/*'
        baseDirectory: .next  # Output folder for Next.js build
      cache:
        paths:
          - 'node_modules/**/*'

  - appRoot: server  # Backend root directory
    backend:
      phases:
        preBuild:
          commands:
            - echo "Installing backend dependencies..."
            - cd server && npm ci
            - echo "Generating Prisma Client..."
            - cd server && npx prisma generate 
        build:
          commands:
           
            - echo "Compiling TypeScript..."
            - cd server && npx tsc --noEmit  # Type-checking only
            - echo "Backend build and Prisma Client generation complete"
            postBuild:
             commands:
               - echo "Backend deployed successfully"
      artifacts:
        files:
          - '**/*'  # Include backend files
      cache:
        paths:
          - 'server/node_modules/**/*'  # Cache server dependencies

env:
  variables:
    NEXT_PUBLIC_API_BASE_URL: http://3.111.218.29
