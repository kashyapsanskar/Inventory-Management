version: 0.2

applications:
  - appRoot: .  # This is the frontend's root directory. Here, '.' points to the root of your project
    frontend:
      phases:
        preBuild:
          commands:
            - echo Installing frontend dependencies...
            - npm ci
        build:
          commands:
            - echo Building frontend...
            - npm run build  # Make sure this is the correct build command for Next.js
        postBuild:
          commands:
            - echo Frontend deployed successfully
      artifacts:
        files:
          - '**/*'
        baseDirectory: .next  # Next.js build output folder
      cache:
        paths:
          - 'node_modules/**/*'

  - appRoot: server  # This is the backend directory
    backend:
      phases:
        preBuild:
          commands:
            - echo Installing backend dependencies...
            - cd server && npm ci  # Ensure the correct path to the server folder
        build:
          commands:
            - echo Backend deployed successfully
      artifacts:
        files:
          - '**/*'  # Include all backend files if needed
      cache:
        paths:
          - 'server/node_modules/**/*'

env:
  variables:
    NEXT_PUBLIC_API_BASE_URL: http://3.111.218.29  # Your EC2 backend URL
